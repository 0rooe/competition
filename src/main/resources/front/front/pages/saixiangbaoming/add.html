<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>赛项报名</title>
	<link rel="stylesheet" href="../../layui/css/layui.css">
	<link rel="stylesheet" href="../../xznstatic/css/common.css" />
	<link rel="stylesheet" href="../../xznstatic/css/style.css" />
	<style>
		body {
			background-color: #f6f8fa;
		}

		.add-container {
			width: 1000px;
			margin: 40px auto;
			background: #fff;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
			border-radius: 8px;
			padding: 40px;
		}

		.form-header {
			text-align: center;
			margin-bottom: 30px;
			border-bottom: 1px solid #eee;
			padding-bottom: 20px;
		}

		.form-header h2 {
			font-size: 24px;
			font-weight: 600;
			color: #333;
		}

		.layui-form-item {
			margin-bottom: 25px;
		}

		.layui-form-label {
			width: 120px;
			color: #666;
			font-weight: 500;
		}

		.layui-input-block {
			margin-left: 150px;
		}

		.layui-input,
		.layui-textarea {
			border-radius: 4px;
			border: 1px solid #ddd;
			transition: all 0.3s;
		}

		.layui-input:focus,
		.layui-textarea:focus {
			border-color: #1E9FFF;
			box-shadow: 0 0 0 2px rgba(30, 159, 255, 0.2);
		}

		.readonly-input {
			background-color: #f8f8f8;
			color: #999;
			cursor: not-allowed;
		}

		.btn-submit {
			background-color: #1E9FFF;
			border-radius: 4px;
			height: 40px;
			line-height: 40px;
			padding: 0 40px;
			font-size: 16px;
			border: none;
			transition: background 0.3s;
		}

		.btn-submit:hover {
			background-color: #0088ee;
		}

		.btn-reset {
			height: 40px;
			line-height: 40px;
			padding: 0 30px;
			border-radius: 4px;
			margin-left: 20px;
		}
	</style>
</head>

<body>
	<div id="app" v-cloak>
		<div class="add-container">
			<div class="form-header">
				<h2>赛项报名</h2>
			</div>

			<form class="layui-form" lay-filter="myForm">

				<div class="layui-form-item">
					<label class="layui-form-label">赛项名称</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.saixiangmingcheng" name="saixiangmingcheng" readonly
							class="layui-input readonly-input">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">类型</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.leixing" name="leixing" readonly
							class="layui-input readonly-input">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">级别</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.jibie" name="jibie" readonly
							class="layui-input readonly-input">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">报名费用</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.baomingfeiyong" name="baomingfeiyong" readonly
							class="layui-input readonly-input" style="color: #ff5722; font-weight: bold;">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">学号</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.xuehao" name="xuehao" readonly
							class="layui-input readonly-input">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">姓名</label>
					<div class="layui-input-block">
						<input type="text" v-model="detail.xingming" name="xingming" readonly
							class="layui-input readonly-input">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">报名日期</label>
					<div class="layui-input-block">
						<input type="text" name="baomingriqi" id="baomingriqi" autocomplete="off" class="layui-input"
							placeholder="请选择日期">
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">备注/材料</label>
					<div class="layui-input-block">
						<textarea id="shenbaocailiao" name="shenbaocailiao" placeholder="请输入申报材料或备注信息"
							class="layui-textarea"></textarea>
					</div>
				</div>

				<div class="layui-form-item" style="margin-top: 40px; text-align: center;">
					<button class="layui-btn btn-submit" lay-submit lay-filter="*">提交报名</button>
					<button type="reset" class="layui-btn layui-btn-primary btn-reset">重置</button>
				</div>
			</form>
		</div>
	</div>

	<script src="../../layui/layui.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../modules/config.js"></script>
	<script src="../../js/utils.js"></script>
	<script src="../../js/validate.js"></script>

	<script>
		var vue = new Vue({
			el: '#app',
			data: {
				detail: {
					saixiangmingcheng: '',
					leixing: '',
					jibie: '',
					baomingfeiyong: '',
					baomingriqi: '',
					shenbaocailiao: '',
					xuehao: '',
					xingming: '',
				},
				ro: {},
			},
			methods: {
				jump(url) { jump(url) }
			}
		});

		layui.use(['layer', 'element', 'http', 'jquery', 'form', 'laydate', 'tinymce'], function () {
			var layer = layui.layer;
			var http = layui.http;
			var jquery = layui.jquery;
			var form = layui.form;
			var laydate = layui.laydate;
			var tinymce = layui.tinymce;

			// Date Picker
			laydate.render({
				elem: '#baomingriqi',
				value: new Date() // Default to today
			});

			// TinyMCE (Simplified configuration)
			var edit = tinymce.render({
				elem: "#shenbaocailiao",
				height: 300,
				width: '100%'
			});

			// Get User Info from Session
			var userTable = localStorage.getItem("userTable");
			http.request(`${userTable}/session`, 'get', {}, function (data) {
				if (data.data) {
					vue.detail.xuehao = data.data.xuehao;
					vue.detail.xingming = data.data.xingming;
				}
			});

			// Get Cross Table Data (Competition Info)
			if (http.getParam('corss')) {
				var obj = JSON.parse(localStorage.getItem('crossObj'));
				for (var o in obj) {
					if (o == 'saixiangmingcheng') vue.detail.saixiangmingcheng = obj[o];
					if (o == 'leixing') vue.detail.leixing = obj[o];
					if (o == 'jibie') vue.detail.jibie = obj[o];
					if (o == 'baomingfeiyong') vue.detail.baomingfeiyong = obj[o];
					// Note: We don't overwrite baomingriqi from crossObj usually,
					// unless it's an edit form. For 'add', we default to today.
				}
			}

			// Submit
			form.on('submit(*)', function (data) {
				data = data.field;

				// Get TinyMCE content
				var shenbaocailiao = tinymce.get('#shenbaocailiao').getContent();
				data.shenbaocailiao = shenbaocailiao;

				// Add UserID (Critical Fix)
				data.userid = localStorage.getItem('userid');

				http.requestJson('saixiangbaoming/add', 'post', data, function (res) {
					layer.msg('报名成功！请前往个人中心查看', {
						time: 2000,
						icon: 6
					}, function () {
						// Redirect to my list or back
						// window.location.href = '../saixiangbaoming/list.html'; // Or user center
						back();
					});
				});
				return false;
			});
		});
	</script>
</body>

</html>