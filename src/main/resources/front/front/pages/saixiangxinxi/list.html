<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="utf-8">
	<title>赛项信息</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="stylesheet" href="../../layui/css/layui.css">
	<link rel="stylesheet" href="../../xznstatic/css/common.css" />
	<link rel="stylesheet" href="../../xznstatic/css/style.css" />
	<script type="text/javascript" src="../../xznstatic/js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="../../xznstatic/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<style>
	[v-cloak] {
		display: none !important;
	}
</style>

<body>
	<div id="app" v-cloak>
		<div class="banner">
			<div class="layui-carousel" id="test1" style="width: 100%;">
				<div carousel-item>
					<div v-for="(item,index) in swiperList" :key="index">
						<img :src="item.img" style="width: 100%; height: 100%; object-fit: cover;" />
					</div>
				</div>
			</div>
		</div>

		<div class="section-container">
			<div class="section-header">
				<h2>赛项信息</h2>
				<span>Competition Information</span>
			</div>

			<!-- Search Bar -->
			<div class="search-container">
				<div class="search-item">
					<span class="search-label">赛项名称:</span>
					<input type="text" id="saixiangmingcheng" placeholder="请输入赛项名称" class="search-input">
				</div>
				<div class="search-item">
					<span class="search-label">级别:</span>
					<input type="text" id="jibie" placeholder="请输入级别" class="search-input">
				</div>
				<button id="btn-search" type="button" class="btn-search">
					<i class="layui-icon layui-icon-search"></i> 搜索
				</button>
				<button v-if="isAuth('saixiangxinxi','新增')" @click="jump('../saixiangxinxi/add.html')" type="button"
					class="btn-search" style="background-color: #28a745;">
					<i class="layui-icon">&#xe654;</i> 添加
				</button>
			</div>

			<!-- Competition List -->
			<div class="competition-grid">
				<div @click="jump('../saixiangxinxi/detail.html?id='+item.id)" v-for="(item,index) in dataList"
					:key="index" class="comp-card">
					<div class="img-wrapper">
						<img :src="item.tupian?item.tupian.split(',')[0]:''"
							onerror="this.src='../../xznstatic/img/no-image.png'">
					</div>
					<div class="info">
						<div class="name">{{item.saixiangmingcheng}}</div>
						<div v-if="item.jibie" style="font-size: 13px; color: #999; margin-top: 5px;">{{item.jibie}}
						</div>
					</div>
				</div>
			</div>

			<!-- Pagination -->
			<div class="pager" id="pager" style="text-align: center; margin-top: 40px;"></div>
		</div>
	</div>

	<script src="../../layui/layui.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../modules/config.js"></script>
	<script src="../../js/utils.js"></script>

	<script type="text/javascript">
		var vue = new Vue({
			el: '#app',
			data: {
				swiperList: [],
				dataList: []
			},
			methods: {
				isAuth(tablename, button) {
					return isFrontAuth(tablename, button)
				},
				jump(url) {
					jump(url)
				}
			}
		});

		layui.use(['layer', 'element', 'carousel', 'laypage', 'http', 'jquery'], function () {
			var layer = layui.layer;
			var element = layui.element;
			var carousel = layui.carousel;
			var laypage = layui.laypage;
			var http = layui.http;
			var jquery = layui.jquery;
			var limit = 12;

			// 获取轮播图
			http.request('config/list', 'get', {
				page: 1, limit: 5
			}, function (res) {
				if (res.data.list.length > 0) {
					let swiperList = [];
					res.data.list.forEach(element => {
						if (element.value != null) {
							swiperList.push({ img: element.value });
						}
					});
					vue.swiperList = swiperList;
					vue.$nextTick(() => {
						carousel.render({
							elem: '#test1',
							width: '100%',
							height: '400px',
							arrow: 'hover',
							anim: 'fade',
							autoplay: 'true',
							interval: '4000',
							indicator: 'inside'
						});
					})
				}
			});

			// 分页列表
			pageList();

			// 搜索按钮
			jquery('#btn-search').click(function (e) {
				pageList();
			});

			function pageList() {
				var param = {
					page: 1,
					limit: limit
				}
				if (jquery('#saixiangmingcheng').val()) {
					param['saixiangmingcheng'] = jquery('#saixiangmingcheng').val() ? '%' + jquery('#saixiangmingcheng').val() + '%' : '';
				}
				if (jquery('#jibie').val()) {
					param['jibie'] = jquery('#jibie').val() ? '%' + jquery('#jibie').val() + '%' : '';
				}

				http.request('saixiangxinxi/list', 'get', param, function (res) {
					vue.dataList = res.data.list
					laypage.render({
						elem: 'pager',
						count: res.data.total,
						limit: limit,
						groups: 5,
						layout: ["prev", "page", "next", "skip"],
						theme: '#1E9FFF',
						jump: function (obj, first) {
							if (!first) {
								param.page = obj.curr;
								http.request('saixiangxinxi/list', 'get', param, function (res) {
									vue.dataList = res.data.list
								})
							}
						}
					});
				})
			}
		});
	</script>
</body>

</html>