<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="utf-8">
	<title>新闻资讯</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="stylesheet" href="../../layui/css/layui.css">
	<link rel="stylesheet" href="../../xznstatic/css/common.css" />
	<link rel="stylesheet" href="../../xznstatic/css/style.css" />
	<script type="text/javascript" src="../../xznstatic/js/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="../../xznstatic/js/jquery.SuperSlide.2.1.1.js"></script>
</head>
<style>
	[v-cloak] {
		display: none !important;
	}
</style>

<body>
	<div id="app" v-cloak>
		<!-- Banner (Optional, keep if design requires, or rely on page title) -->
		<div class="banner">
			<div class="layui-carousel" id="test1" style="width: 100%;">
				<div carousel-item>
					<div v-for="(item,index) in swiperList" :key="index">
						<img :src="item.img" style="width: 100%; height: 100%; object-fit: cover;" />
					</div>
				</div>
			</div>
		</div>

		<div class="section-container">
			<!-- Breadcrumb / Header -->
			<div class="section-header">
				<h2>新闻资讯</h2>
				<span>News Center</span>
			</div>

			<div class="news-grid">
				<div @click="jump('../news/detail.html?id='+item.id);" v-for="(item,index) in dataList" :key="index"
					class="news-card">
					<div class="img-box">
						<img :src="item.picture" onerror="this.src='../../xznstatic/img/no-image.png'">
					</div>
					<div class="content">
						<div class="title">{{item.title}}</div>
						<div class="desc" v-if="item.introduction">{{item.introduction}}</div>
						<div class="date"><i class="layui-icon layui-icon-date"></i> {{item.addtime.split(' ')[0]}}
						</div>
					</div>
				</div>
			</div>

			<!-- Pagination -->
			<div class="pager" id="pager" style="text-align: center; margin-top: 40px;"></div>
		</div>
	</div>

	<script src="../../layui/layui.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/config.js"></script>
	<script src="../../modules/config.js"></script>
	<script src="../../js/utils.js"></script>

	<script type="text/javascript">
		var vue = new Vue({
			el: '#app',
			data: {
				swiperList: [],
				dataList: []
			},
			methods: {
				jump(url) {
					jump(url)
				}
			}
		});

		layui.use(['layer', 'element', 'carousel', 'laypage', 'http', 'jquery'], function () {
			var layer = layui.layer;
			var element = layui.element;
			var carousel = layui.carousel;
			var laypage = layui.laypage;
			var http = layui.http;
			var jquery = layui.jquery;
			var limit = 12;

			// 获取轮播图 (保持原有逻辑，虽然现在页面上没显示，防止数据报错)
			http.request('config/list', 'get', {
				page: 1, limit: 5
			}, function (res) {
				if (res.data.list.length > 0) {
					let swiperList = [];
					res.data.list.forEach(element => {
						if (element.value != null) {
							swiperList.push({ img: element.value });
						}
					});
					vue.swiperList = swiperList;
					vue.$nextTick(() => {
						carousel.render({
							elem: '#test1',
							width: '100%',
							height: '400px',
							arrow: 'hover',
							anim: 'fade',
							autoplay: 'true',
							interval: '4000',
							indicator: 'inside'
						});
					})
				}
			});

			// 获取列表数据
			http.request('news/list', 'get', {
				page: 1,
				limit: limit,
				order: 'desc'
			}, function (res) {
				vue.dataList = res.data.list
				// 分页
				laypage.render({
					elem: 'pager',
					count: res.data.total,
					limit: limit,
					groups: 5,
					layout: ["prev", "page", "next", "skip"],
					theme: '#1E9FFF', // Blue Theme
					jump: function (obj, first) {
						if (!first) {
							http.request('news/list', 'get', {
								page: obj.curr,
								limit: obj.limit,
								order: 'desc'
							}, function (res) {
								vue.dataList = res.data.list
							})
						}
					}
				});
			});
		});
	</script>
</body>

</html>